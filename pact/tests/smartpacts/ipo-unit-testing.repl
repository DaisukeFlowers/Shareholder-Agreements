(load "../smartpacts/shares-unit-testing.repl")

(env-data {})
(env-sigs [])

(begin-tx)
(env-chain-data { "block-time" : (time "2025-03-03T00:00:00Z") })
(smartpacts.shares.get-balance smartpacts.shares.SHARES_ACCOUNT)
(print (format "get-balance 'Shares Account' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-balance smartpacts.shares-ipo.IPO_ACCOUNT)
(print (format "get-balance 'IPO Account' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-balance smartpacts.shares.ALLOCATIONS_ACCOUNT)
(print (format "get-balance 'Allocations Account' gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2025-03-03T00:30:00Z") })
(print (format "create-shares-account 'Alice' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-shares-details k.ALICE)
(print (format "shares-details 'Alice' gas cost: {}" [(env-gas)]))
(coin.get-balance k.ALICE)
(print (format "coin.get-balance 'Alice' gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-chain-data { "block-time" : (time "2025-03-03T01:00:00Z") })
(env-sigs [{"key": users-keys.ALICE,
            "caps": [ (smartpacts.shares-ipo.BUY-IPO k.ALICE 10.0) ]}])
(smartpacts.shares-ipo.buy-ipo k.ALICE 10.0)
(print (format "buy-ipo 'Alice' '10 Shares' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-shares-details k.ALICE)
(print (format "shares-details 'Alice' gas cost: {}" [(env-gas)]))
(coin.get-balance k.ALICE)
(print (format "coin.get-balance 'Alice' gas cost: {}" [(env-gas)]))
(smartpacts.shares-ipo.get-balance)
(print (format "get-balance 'IPO Account' gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-chain-data { "block-time" : (time "2025-03-03T01:30:00Z") })
(coin.get-balance smartpacts.shares-ipo.IPO_ACCOUNT)
(coin.get-balance k.ALICE)
(env-sigs [{"key": contract-keys.MANAGER, "caps": [(smartpacts.shares-ipo.SHARES-MANAGER)]}])
(smartpacts.shares-ipo.transfer-funds k.ALICE)
(coin.get-balance k.ALICE)
(commit-tx)