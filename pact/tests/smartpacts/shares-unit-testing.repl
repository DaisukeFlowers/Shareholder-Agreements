(load "../init/init.repl")

(env-data {})
(env-sigs [])
   
(begin-tx)
(env-chain-data { "block-time" : (time "2024-03-03T00:00:00Z") })
(smartpacts.shares.get-balance smartpacts.shares.SHARES_ACCOUNT)
(print (format "get-balance 'Shares Account' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-balance smartpacts.shares-ipo.IPO_ACCOUNT)
(print (format "get-balance 'IPO Account' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-balance smartpacts.shares.ALLOCATIONS_ACCOUNT)
(print (format "get-balance 'Allocations Account' gas cost: {}" [(env-gas)]))
(commit-tx)

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2024-03-03T00:30:00Z") })
(smartpacts.shares.create-shares-account k.ALICE (describe-keyset "smartpacts.alice-keyset"))
(print (format "create-shares-account 'Alice' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-balance k.ALICE)
(print (format "get-balance 'Alice' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-shares-details k.ALICE)
(print (format "get-shares-details 'Alice' gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2024-03-03T01:00:00Z") })
(env-sigs [{"key": contract-keys.MANAGER, "caps": [(smartpacts.shares.SHARES-MANAGER)]}])
(smartpacts.shares.create-allocation k.BOB (time "2024-03-03T01:30:00Z") (describe-keyset "smartpacts.bob-keyset") 1000.0)
(print (format "create-allocation 'Bob' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-balance smartpacts.shares.ALLOCATIONS_ACCOUNT)
(print (format "get-balance 'Allocations Account' gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2024-03-03T01:30:00Z") })
(smartpacts.shares.get-allocation-balance k.BOB)
(print (format "get-allocation-balance 'Bob' gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2024-03-03T02:00:00Z") })
(smartpacts.shares.release-allocation k.BOB)
(print (format "release-allocation 'Bob' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-balance k.BOB)
(print (format "get-balance 'Bob' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-allocation-balance k.BOB)
(print (format "get-allocation-balance 'Bob' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-balance smartpacts.shares.ALLOCATIONS_ACCOUNT)
(print (format "get-balance 'Allocations Account' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-shares-details k.BOB)
(print (format "get-shares-details 'Bob' gas cost: {}" [(env-gas)]))
(commit-tx)

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2024-03-03T02:30:00Z") })
(env-sigs [{"key": users-keys.BOB, "caps": [(smartpacts.shares.TRANSFER k.BOB k.ALICE 50.0)]}])
(smartpacts.shares.transfer k.BOB k.ALICE 50.0)
(print (format "transfer 'Bob' to 'Alice' 50.0 shares gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-shares-details k.BOB)
(print (format "get-shares-details 'Bob' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-shares-details k.ALICE)
(print (format "get-shares-details 'Alice' gas cost: {}" [(env-gas)]))
(commit-tx)

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2024-03-03T03:00:00Z") })
(env-sigs [{"key": users-keys.BOB, "caps": [(smartpacts.shares.TRANSFER k.BOB k.ALICE 50.0)]}])
(smartpacts.shares.transfer k.BOB k.ALICE 50.0)
(print (format "transfer 'Bob' to 'Alice' 50.0 shares gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-shares-details k.BOB)
(print (format "get-shares-details 'Bob' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-shares-details k.ALICE)
(print (format "get-shares-details 'Alice' gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2024-03-03T03:30:00Z") })
(env-sigs [{"key": contract-keys.MANAGER, "caps": [ (smartpacts.shares.SHARES-MANAGER) ]}])
(smartpacts.shares.add-proposal "proposal-1" (time "2024-03-03T04:00:00Z") (time "2024-03-04T04:00:00Z"))
(print (format "add-proposal 'proposal-1' gas cost: {}" [(env-gas)]))
(smartpacts.shares.add-proposal "proposal-2" (time "2024-03-03T04:00:00Z") (time "2024-03-04T04:00:00Z"))
(print (format "add-proposal 'proposal-2' gas cost: {}" [(env-gas)]))
(smartpacts.shares.add-proposal "proposal-3" (time "2024-03-03T04:00:00Z") (time "2024-03-04T04:00:00Z"))
(print (format "add-proposal 'proposal-3' gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2024-03-03T04:00:00Z") })
(smartpacts.shares.get-active-proposals)
(print (format "get-active-proposals gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2024-03-03T04:30:00Z") })
(env-sigs [{"key": users-keys.BOB, "caps": [ (smartpacts.shares.VOTE k.BOB) ]}])
(smartpacts.shares.vote k.BOB "proposal-1")
(print (format "vote 'Bob' 'proposal-1' gas cost: {}" [(env-gas)]))
(env-sigs [{"key": users-keys.ALICE, "caps": [ (smartpacts.shares.VOTE k.ALICE) ]}])
(smartpacts.shares.vote k.ALICE "proposal-2")
(print (format "vote 'Bob' 'proposal-1' gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2024-03-03T05:00:00Z") })
(smartpacts.shares.get-active-proposals)
(print (format "get-active-proposals gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-proposal-details "proposal-1")
(print (format "get-proposal-details 'proposal-1' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-proposal-details "proposal-2")
(print (format "get-proposal-details 'proposal-2' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-proposal-details "proposal-3")
(print (format "get-proposal-details 'proposal-3' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-shares-details k.BOB)
(print (format "get-shares-details 'Bob' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-shares-details k.ALICE)
(print (format "get-shares-details 'Alice' gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2024-03-03T05:30:00Z") })
(coin.get-balance k.BOB)
(print (format "coin.get-balance 'Bob' gas cost: {}" [(env-gas)]))
(coin.get-balance smartpacts.shares.SHARES_ACCOUNT)
(print (format "coin.get-balance 'Shares Account'gas cost: {}" [(env-gas)]))
(env-sigs [
  {"key": users-keys.BOB,"caps": [(coin.TRANSFER k.BOB smartpacts.shares.SHARES_ACCOUNT 50000.0)]}])
(coin.transfer k.BOB smartpacts.shares.SHARES_ACCOUNT 50000.0)
(print (format "coin.transfer 'Bob' 'Shares Account' '50000 KDA' gas cost: {}" [(env-gas)]))
(coin.get-balance k.BOB)
(print (format "coin.get-balance 'Bob' gas cost: {}" [(env-gas)]))
(coin.get-balance smartpacts.shares.SHARES_ACCOUNT)
(print (format "coin.get-balance 'Shares Account'gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2024-03-03T06:00:00Z") })
(env-sigs [{"key": contract-keys.MANAGER, "caps": [ (smartpacts.shares.SHARES-MANAGER) ]}])
(smartpacts.shares.set-dividend 25.0 2024)
(coin.get-balance k.ALICE)
(print (format "coin.get-balance 'Alice' gas cost: {}" [(env-gas)]))
(coin.get-balance k.BOB)
(print (format "coin.get-balance 'Bob' gas cost: {}" [(env-gas)]))
(coin.get-balance smartpacts.shares.SHARES_ACCOUNT)
(print (format "coin.get-balance 'Shares Account'gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2025-03-03T06:00:00Z") })
(smartpacts.shares.get-pending-dividends)
(print (format "get-pending-dividends gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2025-03-03T06:30:00Z") })
(env-sigs [{"key": users-keys.BOB, "caps": [(smartpacts.shares.TRANSFER k.BOB k.ALICE 50.0)]}])
(smartpacts.shares.transfer k.BOB k.ALICE 50.0)
(print (format "transfer 'Bob' to 'Alice' 50.0 shares gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-shares-details k.BOB)
(print (format "get-shares-details 'Bob' gas cost: {}" [(env-gas)]))
(smartpacts.shares.get-shares-details k.ALICE)
(print (format "get-shares-details 'Alice' gas cost: {}" [(env-gas)]))
(coin.get-balance k.ALICE)
(print (format "coin.get-balance 'Alice' gas cost: {}" [(env-gas)]))
(coin.get-balance k.BOB)
(print (format "coin.get-balance 'Bob' gas cost: {}" [(env-gas)]))
(coin.get-balance smartpacts.shares.SHARES_ACCOUNT)
(print (format "coin.get-balance 'Shares Account'gas cost: {}" [(env-gas)]))
(commit-tx)

(env-data {})
(env-sigs [])

(begin-tx)
(env-gas 0)
(env-chain-data { "block-time" : (time "2025-03-03T07:00:00Z") })
(smartpacts.shares.get-pending-dividends)
(print (format "get-pending-dividends gas cost: {}" [(env-gas)]))
(commit-tx)

;pending
;cross chain functions 
;transfer create -interface
;create account -interface
;details -interface
;rotate - interface
;kda-rotate
;release dividends
;get pending dividends
;utility functions